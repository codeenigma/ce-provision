---
aws_acl:
  - name: "{{ _infra_name }}_main_acl"
    description: "ACL rules from ce-provision-config"
    scope: CLOUDFRONT # Can be REGIONAL for ALBs
    region: "us-east-1"
    tags: "{{ _aws_tags }}"
    rules:
      rate_limit:
        value: 600 # set to 0 to skip rate limit rule, set to a value to set how many requests to allow in period before blocking
        priority: 2 # can be float with 1 decimal place
      ip_sets:
        - rule_name: "Allowed-IPs-rule"
          set_name: "Allowed-IPs-set"
          description: "List of IPs from our VPNs - Ansible managed"
          action: allow
          priority: 1
          list:
            - 3.11.82.252/32 # main VPN
            - 159.100.242.248/32 # backup VPN, bastion2
            - 3.8.9.162/32 # guest VPN
      country_codes:
        - name: "allowed-countries"
          action: allow
          priority: 0.2
          list:
            - GB
            - HR
        - name: "blocked-countries"
          action: block
          priority: 8
          list:
            - RU
            - CN
      regular_rules:
        - name: allow_panels
          action: allow
          statements_type: "single" # supported "single", "and", "or" and "not" ("and" and "or" supports multiple statements)
          priority: 4
          statements:
            - inspect: "UriPath" # Use: "SingleHeader" or "UriPath"
              position: "CONTAINS"
              string: "panels/ajax"
              text_trans: "NONE"
#   Example for multi header block
#        - name: block_bots
#          action: block
#          statements_type: "or" # supported "single", "and", "or" and "not" ("and" and "or" supports multiple statements)
#          priority: 5
#          statements:
#            - inspect: "SingleHeader" # Use: "SingleHeader" or "UriPath"
#              position: "CONTAINS"
#              string: "spider"
#              text_trans: "LOWERCASE"
#            - inspect: "SingleHeader" # Use: "SingleHeader" or "UriPath"
#              position: "CONTAINS"
#              string: "bot"
#              text_trans: "LOWERCASE"
#            - inspect: "SingleHeader" # Use: "SingleHeader" or "UriPath"
#              position: "CONTAINS"
#              string: "crawl"
#              text_trans: "LOWERCASE"
      # Managed rules list
      bot_control:
        enabled: false
        target: "COMMON" # "COMMON" or "TARGETED" inspection level
        priority: 3
      cyber_sec:
        enabled: false # Need to subscribe first in AWS
        rule_list: []
        priority: 6
      amazon_ip_reputation:
        enabled: false
        rule_list: []
        priority: 9
      common_rule_set:
        enabled: false
        rule_list: []
        priority: 10
      php_rule_set:
        enabled: false
        rule_list: []
        priority: 11
      known_bad_inputs:
        enabled: false
        rule_list: []
        priority: 12
      anonymous_ip_list:
        enabled: false
        rule_list: []
        priority: 13
