### {{ ansible_managed }}

gzip on;
gzip_proxied any;
gzip_static on;
gzip_http_version 1.0;
gzip_disable "MSIE [1-6]\.";
gzip_vary on;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/javascript
    application/x-javascript
    application/json
    application/xml
    application/xml+rss
    application/xhtml+xml
    application/x-font-ttf
    application/x-font-opentype
    image/svg+xml
    image/x-icon;
gzip_buffers 16 8k;
gzip_min_length 512;
proxy_buffer_size       512k;
proxy_buffers           8 256k;
client_body_buffer_size 512k;
fastcgi_buffer_size     512k ;
fastcgi_buffers         8 256k ;
client_max_body_size    {{ nginx.client_max_body_size }} ;
# Disable content sniffing, since it's an attack vector.
add_header X-Content-Type-Options nosniff;
{% if ssl is defined and ssl.handling == 'letsencrypt' and ssl.http_01_port != 80 %}
# Proxy for certbot (LetsEncrypt)
location /.well-known/acme-challenge/ {
    proxy_pass http://localhost:{{ ssl.http_01_port }}$request_uri;
}
{% endif %}