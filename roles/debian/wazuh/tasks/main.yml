---
# Assumes you have run the ce_provision role on your controller and it has already installed the Wazuh roles
- name: Select items with URL https://github.com/wazuh/wazuh-ansible.git
  ansible.builtin.set_fact:
    _wazuh_items: "{{ ce_provision.contrib_roles | selectattr('repo', 'equalto', 'https://github.com/wazuh/wazuh-ansible.git') | list }}"

- name: Debug print _wazuh_items
  ansible.builtin.debug:
    msg: "{{ _wazuh_items }}"

- name: Set wazuh path based on matching repo
  ansible.builtin.set_fact:
    _wazuh_path: "{{ _wazuh_items | map(attribute='directory') | first }}"
  when: _wazuh_items | length > 0

- name: Debug _wazuh_path before including install.yml
  ansible.builtin.debug:
    msg: "The value of _wazuh_path is: '{{ _wazuh_path | default('Not set') }}'"

- name: Include task to install based on selected items
  ansible.builtin.include_tasks: install.yml
    file: install.yml
  vars:
    _wazuh_path: "{{ _wazuh_path }}"
  when: _wazuh_items | length > 0